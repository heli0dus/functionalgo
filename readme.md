<img src="./fungologo.png" alt="drawing" width="800"/>

# FunGo

FunGo - библиотека для реализации возможностей функционального программирования в языке go. Состоит из следующих пакетов

- **collections** - предоставляет некотоыре коллекции с функциональными инетрфейсами
    - collections/arrayList 
    - collections/hashSet
    - collections/maybe
    - collections/linkedList
    - collections/forwardList
- **functools** - предоставляет функции высшего порядка для композиции и продвинутой работы с базовыми функциями
- **stream** - предоставляет базовые функции по аналогии с Java Stream API, а именно
    - `Fmap(f)` - применяет переданную функцию ко всем элементам стрима
    - `FlatMap(f)` - применяет переданную функцию возвращающую срез и объединяет полученные срезы в один общий стрим
    - `Take(x)` - берёт первые `x` элементов стрима
    - `TakeWhile(p)` - сохраняет в стриме первые элементы пока они соответствуют предикату `p`
    - `Drop(x)` - отбрасывает первые `x` элементов стрима
    - `DropWhile(p)` - отбрасывает элементы стрима пока они соответствуют предикату `p`
    - `Filter(p)` - сохраняет в стриме только элементы, при которых выполянется предикат `p`
    - `Reduce(f, init)` - левая свёртка стрима
    - `All(p)` - `true`, если для всех элементов стрима выполняется предикат `p`
    - `Any(p)` - `true`, если хотя бы для одного элемента стрима выполняется предикат `p`

    Все функции работы со стримами поддерживают обработку ошибок: в случае, если переданная функция вторым возвращаемым значением вернет ошибку, стрим инвалидируется и впоследствии вернет эту ошибку при попытке получения из него среза/значения.

    Также в наличии функции для конвертирования коллекций в стримы и назад
    - `AsStream(streamable)` - преобразовать коллекцию к стриму (для этого требуется, чтобы коллекция реализовывала интерфейс `streamable` (метод `ToSlice()`))
    - `AsSlice[T](stream)` - преобразовать стрим в `[]T`. Данная функция вернет ошибку, если стрим инвалидирован, или если запрошено невозможное преобразование типа.
    - `As[T](stream)` - достать из стрима единственное значение и преобразовать в `T`. Данная функция вернет ошибку, если стрим инвалидирован, если в стриме не одно значение, или если запрошено невозможное преобразование типа.

# Технические детали

Для коллекций функции реализованы при помощи generic функций. Стримы же используют типовую рефлексию

# Пример

В файле `main.go` приведен пример использования библиотеки стримов. Команда для сборки и запуска примера:

```bash
go run main.go
```

Также есть еще один пример в `examples/example.go`

# Тесты и бенчмарки

Команда для прогона всех тестов:

```bash
go test ./...
```

Команда для прогона всех бенчмарков:

```bash
go test -run ^$ -bench=. ./...
```

# Результаты бенчмарков

Все бенчмарки запускались командой

```bash
go test -run ^$ -bench=. -benchtime=10s -benchmem ./...
```

Бенчмарки, основанные на задаче из `main.go`:

| Name                          | Total ops number | Ns/op       | Bytes/op  | Allocs/op    |
|-------------------------------|------------------|-------------|-----------|--------------|
| BenchmarkClassic-20           | 140920328        | 84.49 ns/op | 56 B/op   | 3 allocs/op  |
| BenchmarkStream-20            | 2385086          | 5034 ns/op  | 1528 B/op | 73 allocs/op |
| BenchmarkClassicFilterOnly-20 | 146075796        | 82.07 ns/op | 56 B/op   | 3 allocs/op  |
| BenchmarkStreamFilterOnly-20  | 16809561         | 707.1 ns/op | 180 B/op  | 11 allocs/op |
| BenchmarkClassicMapOnly-20    | 82648896         | 138.1 ns/op | 248 B/op  | 5 allocs/op  |
| BenchmarkStreamMapOnly-20     | 5971581          | 2023 ns/op  | 800 B/op  | 31 allocs/op |
| BenchmarkClassicReduceOnly-20 | 465145737        | 25.82 ns/op | 0 B/op    | 0 allocs/op  |
| BenchmarkStreamReduceOnly-20  | 38740669         | 306.0 ns/op | 88 B/op   | 5 allocs/op  |


Бенчмарки, основанные на задаче из `examples/example.go`

| Name                | Total ops number | Ns/op         | Bytes/op    | Allocs/op       |
|---------------------|------------------|---------------|-------------|-----------------|
| BenchmarkStreams-20 | 9559             | 1193236 ns/op | 326055 B/op | 17273 allocs/op |
| BenchmarkClassic-20 | 180752           | 67236 ns/op   | 136991 B/op | 1589 allocs/op  |
